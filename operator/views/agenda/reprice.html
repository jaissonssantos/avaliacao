<md-header></md-header>
<div id="base">

  <div class="offcanvas">
  </div>

  <div id="content" ng-init="load();">
    <section>
      <div class="section-header">
        <ol class="breadcrumb">
          <li><i class="fa fa-2x fa-calendar"></i>  <a href="agenda">Agenda</a></li>
          <li class="active">Reagendamento</li>
        </ol>
      </div>
      <div class="section-body contain-lg">
        <div class="col-md-12">

          <div class="card">

            <div class="card-body">
              
              <div ng-if="success" class="text-center">
                <div class="border-radius-icon border-success">
                  <i class="md md-done text-success md-4x"></i>
                </div>
                <h4 ng-bind="success"></h4>
                <p class="m-t-10 m-b-5">O compromisso está disponível no calendário e foi reagendado para data e horário selecionados.</p>
                <a href="javascript:void(0);" 
                  ng-click="cancelar()" 
                  class="btn btn-sm btn-primary">Retornar à agenda</a>
              </div>

              <form ng-if="!success" id="agendaForm" name="agendaForm" class="form-horizontal" role="form" novalidate>
                <h3 class="text-light text-light-gray">Agendado</h3>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal">Profissional</label>
                    <input type="hidden" id="profissional" name="profissional" value="">
                    <div class="col-md-9">
                      <div class="form-control disabled"
                        ng-bind="agenda.profissional + '/' + agenda.profissao"></div>
                    </div>
                </div>

                <div ng-if="agenda.convenio!=undefined" class="form-group block-warning">
                  <label class="col-md-3 control-label form-horizontal">Convênio</label>
                    <div class="col-md-9">
                      <div class="form-control disabled"
                        ng-bind="agenda.convenio"></div>
                    </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal">Cliente</label>
                  <div class="col-md-9">
                      <div class="form-control disabled"
                        ng-bind="agenda.clientenome"></div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal">Número celular</label>
                  <div class="col-md-9">
                      <div class="form-control disabled"
                        ng-bind="agenda.telefonecelular|brPhoneNumber"></div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal">E-mail</label>
                  <div class="col-md-9">
                      <div class="form-control disabled"
                        ng-bind="agenda.clienteemail"></div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal">Quando?</label>
                  <div class="col-md-3">
                      <div class="form-control disabled"
                        ng-bind="agenda.data"></div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal">A que horas?</label>
                  <div class="col-md-3">
                      <div class="form-control disabled"
                        ng-bind="agenda.horainicial + ' - ' + agenda.horafinal"></div>
                  </div>
                </div>

                <hr class="panel-wide">
                <h3 class="text-light text-light-gray">Reagendar para</h3>

                <div ng-if="agenda.convenio!=undefined" class="form-group block-warning">
                  <label class="col-md-3 control-label form-horizontal">Convênio</label>
                    <div class="col-md-9">
                      <select ng-model="agenda.idconvenio"
                        ng-init="loadConvenios();"
                        ng-options="convenio.id as convenio.nome for convenio in convenios"
                        name="convenio" 
                        id="convenio" 
                        class="form-control"
                        required>
                            <option value="">Escolha o convênio</option>
                      </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-md-3 control-label form-horizontal"><abbr>*</abbr>Serviço</label>
                    <div class="col-md-3">
                      <select ng-model="agenda.idservico"
                        ng-init="loadServicos();"
                        ng-options="s.id as s.nome for s in servico"
                        name="servico" 
                        id="servico" 
                        class="form-control">
                            <option value="">Escolha o serviço</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                      <button type="button" class="btn btn-sm btn-primary" 
                        ng-click="addServico(agenda.idservico)">
                        <i class="fa fa-plus"></i>
                      </button>
                    </div>
                </div><!-- end .form-group -->

                <div class="form-group">
                    <div class="col-md-9 col-md-offset-3">
                      <div class="table-modal">
                        <table class="table table-striped table-hover no-margin">
                          <thead>
                            <tr>
                              <th width="1%">#</th>
                              <th width="49%">Serviço</th>
                              <th class="text-center text-medium" width="10%">Valor</th>
                              <th width="15%"></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr ng-if="!agenda.servicos.length">
                              <td colspan="4">Nenhum serviço adicionado</td>
                            </tr>
                            <tr ng-if="agenda.servicos.length" 
                              ng-repeat="servico in agenda.servicos">
                              <td>{{$index+1}}</td>
                              <td>{{servico.nome}}</td>
                              <td class="text-center text-medium">
                                <span ng-if="servico.valorpororcamento==1" ng-bind="'-'"></span>
                                <span ng-if="servico.promocao==0 && servico.valorpororcamento==0"
                                  ng-bind="servico.valor|finance:true:2"></span>
                                <span ng-if="servico.promocao==1 && servico.valorpororcamento==0"
                                  ng-bind="servico.valorpromocao|finance:true:2"></span>
                              </td>
                              <td class="text-right text-medium">
                                <button type="button" class="btn btn-sm btn-danger" ng-click="delServico(servico.id)">
                                  <i class="fa fa-trash"></i>
                                </button>
                              </td>
                            </tr>
                            <tr ng-if="agenda.servicos.length" class="active">
                              <td></td>
                              <td colspan="1" class="text-right text-medium">Total</td>
                              <td class="text-center text-medium">{{total | finance:true:2}}</td>
                              <td></td>
                            </tr>
                          </tbody>
                        </table><!-- end table -->
                      </div><!-- end .table-modal -->  
                    </div><!-- end .col-md-12 -->
                </div><!-- end .form-group -->

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal"><abbr>*</abbr>Data</label>
                  <div class="col-md-3">
                    <adm-dtp 
                      ng-model="agenda.reagenda.data" 
                      options='{calType: "gregorian", format: "DD/MM/YYYY", autoClose: "true"}' on-change="changeData()" 
                      on-close="close()"
                      required>
                    </adm-dtp>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal"><abbr>*</abbr>Horário</label>
                  <div class="col-md-3">
                        <select ng-model="agenda.reagenda.horario" 
                          ng-options="horario for horario in horarios"
                          id="horario" 
                          name="horario"
                          class="form-control" 
                          required>
                            <option value="">Escolha um horário</option>
                        </select>
                        <i ng-if="timestatus.loading" 
                          class="fa fa-spin fa-spinner load-ondemand"></i>
                        <span class="help-block text-danger" ng-show="agendaForm.horario.$dirty && agendaForm.horario.$error.required">Qual o horário do atendimento?</span>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal"><abbr>*</abbr> Duração</label>
                  <div class="col-md-3">
                    <select ng-model="agenda.reagenda.duracao" 
                        ng-options="atendimento.tempo as atendimento.hora for atendimento in duracao"
                        name="duracao" 
                        id="duracao" 
                        class="form-control" 
                        required>
                          <option value="">Selecione o tempo de atendimento</option>
                    </select>
                    <span class="help-block text-danger" ng-show="agendaForm.duracao.$dirty && agendaForm.duracao.$invalid">Qual a duração do(s) serviço(s)?</span>
                  </div>
                </div>

                <div class="form-group">
                  <label class="col-md-3 control-label form-horizontal">Observações</label>
                  <div class="col-md-9">
                        <textarea ng-model="agenda.observacao" 
                                id="observacao" 
                                name="observacao" 
                                rows="2"
                                class="form-control">
                        </textarea>  
                  </div>
                </div>


                <hr class="panel-wide">
                <div class="form-group">
                  <div class="col-md-9 col-md-offset-3">
                  <button type="button" 
                    class="btn btn-sm btn-primary" 
                    ng-click="update()" 
                    ng-class="{disabled: agendaForm.$invalid || !agenda.servicos.length || status.loading}"><i ng-if="status.loading" class="fa fa-spin fa-spinner"></i> Reagendar</button>
                    <a href="javascript:void(0);" ng-click="cancelar()">Cancelar</a>  
                  </div>
                </div>
              </form>
            </div>
          </div>
      </div>
    </div>
    </section>
  </div>
  <md-sidebar></md-sidebar>
  <md-aside></md-aside>
</div>